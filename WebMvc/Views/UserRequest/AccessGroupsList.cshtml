@model Reports.Presenters.UI.ViewModel.AccessGroupsListModel
@using Reports.Presenters.Services.Impl
@using Reports.Core
@{
    ViewBag.Title = "Группы доступа";
}

@using (Html.BeginForm("AccessGroupsList", "Userrequest", FormMethod.Post, new { enctype = "multipart/form-data", id = "AccessGroupsList" }))
{
    <table style="width:100%">
        <tr>
            <td>
              <div class="filter-wrap">
                <table style="width:100%">
                    <tr>
                        <td style="width:220px">
                            <b>Выбор параметров</b>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.ValidationSummary(false)
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.LabelFor(m => m.DepartmentName):
                        </td>
                        <td>
                            <label id="DepartmentNameLabel">@Model.DepartmentName</label>
                            <input type="hidden" id="DepartmentName" name="DepartmentName" value="@Model.DepartmentName" />
                            <input type="hidden" id="DepartmentId" name="DepartmentId" value="@Model.DepartmentId" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <input type="button" value="Выбрать" onclick="changeDepartment();"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.LabelFor(m => m.AccessGroupCode):
                        </td>
                        <td>
                            @Html.DropDownListFor(model => model.AccessGroupCode, new SelectList(Model.AccessGroups, "Value", "Text")) 
                            </td>
                    </tr>
                    <tr>
                        <td>
                            @Html.LabelFor(m => m.UserName):
                        </td>
                        <td>
                            @Html.TextBoxFor(model => model.UserName, (object) new { placeholder = "ФИО" })
                        </td>
                    </tr>
                      
                    <tr>
                        <td>
                        <button id="btnSelect" type="button">Выбрать</button>
                        <input type="button" value="Очистить" onclick="resetFilter();"/>
                        </td>
                    </tr>
                </table>
            </div>                          
            </td>
        </tr>
         <tr>
            <td >
                <input type="hidden" id="SortBy" name="SortBy" value="@Model.SortBy" />
                <input type="hidden" id="SortDescending" name="SortDescending" value="@Model.SortDescending" />
                <table class="grid" style="width:100%">
                    <tr>
                        <th>№<br />п/п</th>
                        <th>
                            <div id="sort1"><a href="#"  onclick = "$('#AGList').remove(); SortChanged(1);">Ф.И.О.</a></div>
                        </th>
                        <th>
                            <div id="sort2"><a href="#"  onclick = "$('#AGList').remove(); SortChanged(2);">Должность</a></div>
                        </th>
                        <th>
                            <div id="sort3"><a href="#"  onclick = "$('#AGList').remove(); SortChanged(3);">Подразделение<br /> 3 уровня</a></div>
                        </th>
                        <th>
                            <div id="sort4"><a href="#"  onclick = "$('#AGList').remove(); SortChanged(4);">Подразделение<br />7 уровня</a></div>
                        </th>
                        <th>
                            <div id="sort5"><a href="#"  onclick = "$('#AGList').remove(); SortChanged(5);">Группа доступа</a></div>
                        </th>
                    </tr>
                    <tbody id="AGList">
                        @if (Model.AccessGroupList != null && Model.AccessGroupList.Count > 0)
                        {
                            var i = 1;
                            foreach (var doc in Model.AccessGroupList)
                            {
                                <tr>
                                    <td>
                                        @i
                                    </td>
                                    <td>@doc.UserName</td>
                                    <td>@doc.PositionName</td>
                                    <td>@doc.Dep3Name</td>
                                    <td>@doc.Dep7Name</td>
                                    <td>@doc.AccessGroupName</td>
                                </tr>
                                i++;
                            }
                        }
                    </tbody>
                </table>
            </td>
        </tr>
    </table> 
}

<script src="@Url.Content("~/Scripts/TableSort.js")" type="text/javascript"></script>

<script type="text/javascript">
    var actionDepUrl = "@Url.Action("GetChildren", "Home")";
    var actionDepDialogUrl = "@Url.Action("DepartmentDialog", "Home")";
    $(document).ready(function () {
        //$("#BeginDate").datepicker({changeMonth: true, changeYear: true});
        //$("#EndDate").datepicker({changeMonth: true, changeYear: true});
        //$(".hasDatepicker").width("75px");
        setSortFields();
        setActiveMenuItem("userAcceptGroup");
        $("#btnSelect").click(function(){
            $("#AGList").remove();
            $("#AccessGroupsList").submit();
        });
        
    });
    function resetFilter() {
        //$("#BeginDate").val('');
        //$("#EndDate").val('');
        $("#DepartmentId").val('0');
        $("#DepartmentNameLabel").text('');
        $("#DepartmentName").val('');
        $("#AccessGroupCode").val('');
        $("#UserName").val('');
    }

 </script>   
