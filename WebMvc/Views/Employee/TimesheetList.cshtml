@model Reports.Presenters.UI.ViewModel.TimesheetListModel
@{
    ViewBag.Title = "Табель";
}
@using (Html.BeginForm())
{
    <table>
        <tr>
            <td>
                @Html.HiddenFor(m => m.ManagerId)
                @Html.HiddenFor(m => m.IsEditable)
                @Html.LabelFor(m => m.Month):
                @Html.DropDownListFor(model => model.Month, new SelectList(Model.Monthes, "Id", "Name"), new { onchange = "ChangeMonth();"}) 
                @Html.LabelFor(m => m.Year):
                @Html.DropDownListFor(model => model.Year, new SelectList(Model.Years, "Id", "Name"), new { onchange = "ChangeMonth();"})
            </td>
        </tr>
        <tr>
            @if (Model.TimesheetDtos != null && Model.TimesheetDtos.Count > 0)
            {
                <td style="text-align:left">
                    @for (int i = 1; i <= Model.NumberOfPages; i++)
                    {
                        if (i == Model.CurrentPage)
                        {
                            <text>@i</text>
                        }
                        else
                        {    
                            <a href="" onclick="return OnPageClick(@i);">@i</a>
                        }
                    }
                </td>
            }
         </tr>
        <tr>
            <td>
                @Html.EditorFor(model => model.TimesheetDtos)
            </td>
        </tr>
        <tr>
        <td>
            <hr style="width:100%"/>
        </td>
        </tr>
        <tr>
            @if (Model.TimesheetDtos != null && Model.TimesheetDtos.Count > 0)
            {
                <td style="text-align:left">
                    <input type="hidden" id="CurrentPage" name="CurrentPage" value="@Model.CurrentPage" />
                    @for (int i = 1; i <= Model.NumberOfPages; i++)
                    {
                        if (i == Model.CurrentPage)
                        {
                            <text>@i</text>
                        }
                        else
                        {    
                            <a href="" onclick="return OnPageClick(@i);">@i</a>
                        }
                    }
                </td>
            }
        </tr>
    </table>
}
<script type="text/javascript">
    function ChangeMonth() {
        window.location.href = '@Url.Action("TimesheetList", "Employee")?managerId=' + $("#ManagerId").val() + '&month=' + $("#Month").val() + '&year=' + $("#Year").val();
    }
    function OnPageClick(pageNumber) {
        $("#CurrentPage").val(pageNumber);
        submitForm();
        return false;
    }
    function submitForm() {
        if (document.forms[0].onsubmit && !document.forms[0].onsubmit())
            return;
        document.forms[0].submit();
    }                                
</script>

