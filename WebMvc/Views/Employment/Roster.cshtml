@model Reports.Presenters.UI.ViewModel.Employment2.RosterModel
@{
    Layout = "~/Views/Shared/_LayoutEmployment.cshtml";
    ViewBag.Title = "Прием - Реестр по приему";
}

@* BEGIN Выбор параметров *@

@using (Html.BeginForm())
{
    <table style="width:100%">
        <tr>
            <td colspan="2">
                <div class="filter-wrap">
                    <table>
                        <tr>
                            <td colspan="2">
                                <span style="font-weight: bold">Выбор параметров</span>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                @Html.ValidationSummary(false)
                            </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.LabelFor(m => m.DepartmentName):
                            </td>
                            <td>
                                <label id="DepartmentNameLabel">@Model.DepartmentName</label>
                                <input type="hidden" id="DepartmentName" name="DepartmentName" value="@Model.DepartmentName" />
                                <input type="hidden" id="DepartmentId" name="DepartmentId" value="@Model.DepartmentId" />
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <input type="button" value="Выбрать" onclick="changeDepartment();"/>           
                            </td>
                        </tr>
                        <tr>
                                <td>
                                @Html.LabelFor(m => m.StatusId):
                            </td>
                            <td>
                                @Html.DropDownListFor(model => model.StatusId, Model.Statuses, string.Empty)
                                </td>
                        </tr>
                        <tr>
                            <td>
                                @Html.LabelFor(m => m.UserName):
                            </td>
                            <td>
                                @Html.TextBoxFor(model => model.UserName)
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                @Html.LabelFor(m => m.BeginDate):
                                @Html.EditorFor(model => model.BeginDate) 
                                @Html.LabelFor(m => m.EndDate):
                                @Html.EditorFor(model => model.EndDate) 
                                </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                            <input type="submit" value="Выбрать"/>
                            <input type="button" value="Очистить" onclick="resetFilter();"/>
                            </td>
                        </tr>
                    </table>
                </div>
            </td>
        </tr>
    </table>
}

@* END Выбор параметров *@

<fieldset class="bordered doc-wrap panel">
<legend>Реестр по приему</legend>

<table class="grid">

<tr>
        
    <th>
        №<br />п/п
    </th>
        
    <th>
        ФИО
    </th>

    <th>
        Дирекция
    </th>

    <th>
        Город<br />места<br />работы
    </th>

    <th>
        Структурное<br />подразделение
    </th>

    <th>
        Должность
    </th>        
        
    <th>
        Дата<br />приема
    </th>
        
    <th>
        Номер<br />приказа
    </th>
        
    <th>
        Дата<br />приказа
    </th>

    <th>
        Номер<br />трудового<br />договора
    </th>

    @* Вид работы (осн./совм.) *@
    @* Характер работы (пост./врем.) *@

    <th>
        Исп.<br />срок
    </th>

    <th>
        График<br />работы
    </th>

    <th>
        Дата<br />рождения
    </th>

    <th>
        Инвалидность
    </th>

    <th>
        Грейд
    </th>

    <th>
        Текущее<br />состояние
    </th>

    @if (Model.IsBulkApproveByManagerAvailable)
    {
        <th>
            <br />Согласовано<br />руководителем<br />
            <input type="checkbox" id="setAllByManager" />
        </th>
    }
    
    @if (Model.IsBulkApproveByHigherManagerAvailable)
    {
        <th>
            Согласовано<br />вышестоящим<br />руководителем<br />
            <input type="checkbox" id="setAllByHigherManager" />
        </th>
    }
    
</tr>

@{ int i = 1; }

@foreach (var candidate in Model.Roster)
{
  
    <tr>
        
        <td rowspan="2">
            @i
        </td>
        
        <td rowspan="2">
            @candidate.Name
        </td>

        <td>
            @candidate.Directorate
        </td>

        <td>
            @candidate.WorkCity
        </td>

        <td>
            @candidate.Department
        </td>

        <td>
            @candidate.Position
        </td>        
        
        <td>
            @(candidate.EmploymentDate.HasValue ? candidate.EmploymentDate.Value.ToShortDateString() : String.Empty)
        </td>
        
        <td>
            @candidate.EmploymentOrderNumber
        </td>
        
        <td>
            @(candidate.EmploymentOrderDate.HasValue ? candidate.EmploymentOrderDate.Value.ToShortDateString() : String.Empty)
        </td>

        <td>
            @candidate.ContractNumber
        </td>

        @* Вид работы (осн./совм.) *@
        @* Характер работы (пост./врем.) *@

        <td>
            @candidate.ProbationaryPeriod
        </td>

        <td>
            @candidate.Schedule
        </td>

        <td>
            @(candidate.DateOfBirth.HasValue ? candidate.DateOfBirth.Value.ToShortDateString() : String.Empty)
        </td>

        <td>
            @candidate.Disabilities
        </td>

        <td>
            @candidate.Grade
        </td>

        <td>
            @candidate.Status
        </td>
        
        @if (Model.IsBulkApproveByManagerAvailable)
        {
            <td rowspan="2" class="centered">
                @if (!Model.Roster[i - 1].IsApprovedByManager.HasValue)
                {
                    Model.Roster[i - 1].IsApprovedByManager = false;
                }
                @if (Model.Roster[i - 1].IsApproveByManagerAvailable)
                {
                    @Html.CheckBoxFor(m => m.Roster[i - 1].IsApprovedByManager.Value, new { @class = "selcheckManager" })
                }
            </td>
        }
        
        @if (Model.IsBulkApproveByHigherManagerAvailable)
        {
            <td rowspan="2" class="centered">
                @if (!Model.Roster[i - 1].IsApprovedByHigherManager.HasValue)
                {
                    Model.Roster[i - 1].IsApprovedByHigherManager = false;
                }
                @if (Model.Roster[i - 1].IsApproveByHigherManagerAvailable)
                {
                    @Html.CheckBoxFor(m => m.Roster[i - 1].IsApprovedByHigherManager.Value, new { @class = "selcheckHigherManager" })
                }
            </td>
        }        

        @{i++;}
    </tr>
    <tr>
        <td colspan="14">
            Анкета:
            <span class="buttonLink">@Html.ActionLink("Общая информация", "GeneralInfo", new { id = candidate.Id })</span>
            <span class="buttonLink">@Html.ActionLink("Паспортные данные", "Passport", new { id = candidate.Id })</span>
            <span class="buttonLink">@Html.ActionLink("Образование", "Education", new { id = candidate.Id })</span>
            <span class="buttonLink">@Html.ActionLink("Состав семьи", "Family", new { id = candidate.Id })</span>
            <span class="buttonLink">@Html.ActionLink("Воинский учет", "MilitaryService", new { id = candidate.Id })</span>
            <span class="buttonLink">@Html.ActionLink("Трудовая деятельность", "Experience", new { id = candidate.Id })</span>
            <span class="buttonLink">@Html.ActionLink("Контактные данные", "Contacts", new { id = candidate.Id })</span>
            <span class="buttonLink">@Html.ActionLink("Заявление о приеме", "ApplicationLetter", new { id = candidate.Id })</span>
        </td>
    </tr>
}

</table>

</fieldset>

<script src="/Scripts/UIHelpers.js" type="text/javascript"></script>

<script type="text/javascript">
    var actionDepUrl = "@Url.Action("GetChildren", "Home")";
    var actionDepDialogUrl = "@Url.Action("DepartmentDialog", "Home")";

    $(document).ready(function () {
        setActiveMenuItem("empRoster");
        attachDatepickerToInputs($('#BeginDate, #EndDate'), "-1:+0", true);

        $("#setAllByManager, #setAllByHigherManager").click(function(){
            if ($(this).is(':checked'))
            {
                $(".selcheck").attr('checked','checked');
            }
            else
            {
                $(".selcheck").removeAttr('checked');
            }
         });
    });

    function resetFilter() {
        $("#BeginDate").val('');
        $("#EndDate").val('');

        $("#DepartmentId").val('0');
        $("#DepartmentNameLabel").text('');
        $("#DepartmentName").val('');

        if ($('#PositionId option').length > 1)
            $("#PositionId").val('0');
        $("#VacationTypeId").val('0');
        $("#RequestStatusId").val('0');
        $("#UserName").val('');
    }
</script>