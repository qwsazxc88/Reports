@model Reports.Presenters.UI.ViewModel.Employment2.GeneralInfoModel
@{
    Layout = "~/Views/Shared/_LayoutEmployment.cshtml";
    ViewBag.Title = "Прием - Общая информация";
}
@{Html.EnableClientValidation();}
@{Html.EnableUnobtrusiveJavaScript();}
@using (Html.BeginForm("GeneralInfo", "Employment", FormMethod.Post, new { enctype = "multipart/form-data", id = "general-info-form" }))
{
    <input type="hidden" id="cmd" name="cmd" />
    
    <div class="doc-wrap">
        <fieldset style="border: 1px solid lightgray">
        <legend>Общая информация</legend>
        <table>
            <tr>
                <td style="width: 300px;">
                    @Html.LabelFor(m => m.LastName)
                </td>
                <td>
                    @Html.TextBoxFor(m => m.LastName)
                    @Html.ValidationMessageFor(m => m.LastName)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.FirstName)
                </td>
                <td>
                    @Html.TextBoxFor(m => m.FirstName)
                    @Html.ValidationMessageFor(m => m.FirstName)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.Patronymic)
                </td>
                <td>
                    @Html.TextBoxFor(m => m.Patronymic)
                    @Html.ValidationMessageFor(m => m.Patronymic)
                    <br />
                    @Html.CheckBoxFor(m => m.IsPatronymicAbsent)
                    @Html.LabelFor(m => m.IsPatronymicAbsent)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.NameChanges)
                </td>
                <td>
                    <div style="border: 1px solid lightgray; padding: 5px;">

                    <div id="name-changes-container">
                        @for (var i = 0; i < Model.NameChanges.Count; i++)
                        {
                            // Изменения ФИО                        
                            <table class="grid" data-id=@i>
                                <tr>                                
                                    <td>
                                        @Html.LabelFor(m => m.NameChanges[i].PreviousName):
                                    </td>
                                    <td>
                                        @Html.TextBoxFor(m => m.NameChanges[i].PreviousName)
                                    </td>                                
                                </tr>
                                <tr>
                                    <td>
                                        @Html.LabelFor(m => m.NameChanges[i].Date):
                                    </td>
                                    <td>
                                        @Html.EditorFor(m => m.NameChanges[i].Date)
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        @Html.LabelFor(m => m.NameChanges[i].Place):
                                    </td>
                                    <td>
                                        @Html.EditorFor(m => m.NameChanges[i].Place)
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        @Html.LabelFor(m => m.NameChanges[i].Reason):
                                    </td>
                                    <td>
                                        @Html.EditorFor(m => m.NameChanges[i].Reason)
                                    </td>
                                </tr>                       
                            </table>
                        }
                    </div>

                    <button type="submit" id="add-name-change-button">Добавить новую запись</button>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.IsMale)
                </td>
                <td>
                    @Html.DropDownList("IsMale", new List<SelectListItem>
                        { new SelectListItem {Value = "true", Text = "М"},
                          new SelectListItem {Value = "false", Text = "Ж"}
                        })
                    @Html.ValidationMessageFor(m => m.IsMale)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.Citizenship)
                </td>
                <td>
                    @Html.DropDownListFor(m => m.Citizenship, Model.CitizenshipItems)
                    @Html.ValidationMessageFor(m => m.Citizenship)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.InsuredPersonType)
                </td>
                <td>
                    @Html.DropDownListFor(m => m.InsuredPersonType, Model.InsuredPersonTypeItems)
                    @Html.ValidationMessageFor(m => m.InsuredPersonType)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.DateOfBirth)
                </td>
                <td>
                    @Html.EditorFor(m => m.DateOfBirth)
                    @Html.ValidationMessageFor(m => m.DateOfBirth)
                </td>
            </tr>
            <tr>
                <td>
                    Место рождения
                </td>
                <td>
                    &nbsp;
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.RegionOfBirth)
                </td>
                <td>
                    @Html.TextBoxFor(m => m.RegionOfBirth)
                    @Html.ValidationMessageFor(m => m.RegionOfBirth)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.CityOfBirth)
                </td>
                <td>
                    @Html.TextBoxFor(m => m.CityOfBirth)
                    @Html.ValidationMessageFor(m => m.CityOfBirth)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.ForeignLanguages)
                </td>
                <td>
                    <div id="foreign-languages-container">
                        <table class="grid">
                            <thead>
                                <tr>
                                    <th>
                                        Язык
                                    </th>
                                    <th>
                                        Степень знания
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (var i = 0; i < Model.ForeignLanguages.Count; i++)
                                {                            
                                    <tr>                                
                                        <td>
                                            @Html.EditorFor(m => m.ForeignLanguages[i].LanguageName)
                                        </td>
                                        <td>
                                            @Html.EditorFor(m => m.ForeignLanguages[i].Level)
                                        </td>
                                    </tr>
                                }
                            </tbody>                            
                        </table>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.INN)
                </td>
                <td>
                    @Html.TextBoxFor(m => m.INN)
                    @Html.ValidationMessageFor(m => m.INN)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.SNILS)
                </td>
                <td>
                    @Html.TextBoxFor(m => m.SNILS)
                    @Html.ValidationMessageFor(m => m.SNILS)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.Disabilities)
                </td>
                <td>
                    <div id="disabilities-container">
                        <table class="grid">
                            <thead>
                                <tr>
                                    <th>
                                        Серия справки
                                    </th>
                                    <th>
                                        Номер справки
                                    </th>
                                    <th>
                                        Дата выдачи
                                    </th>
                                    <th>
                                        Группа инвалидности
                                    </th>
                                    <th>
                                        Срок действия справки
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (var i = 0; i < Model.ForeignLanguages.Count; i++)
                                {                            
                                    <tr>                                
                                        <td>
                                            @Html.EditorFor(m => m.Disabilities[i].CertificateSeries)
                                        </td>
                                        <td>
                                            @Html.EditorFor(m => m.Disabilities[i].CertificateNumber)
                                        </td>
                                        <td>
                                            @Html.EditorFor(m => m.Disabilities[i].DateOfIssue)
                                        </td>
                                        <td>
                                            @Html.EditorFor(m => m.Disabilities[i].DisabilityDegree)
                                        </td>
                                        <td>
                                            @Html.EditorFor(m => m.Disabilities[i].CerificateExpirationDate)
                                        </td>
                                    </tr>
                                }
                            </tbody>                            
                        </table>
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.Status)
                </td>
                <td>
                    @Html.DropDownListFor(m => m.Status, Model.StatusItems)
                    @Html.ValidationMessageFor(m => m.Status)
                </td>
            </tr>
            <tr>
                <td>
                    @Html.LabelFor(m => m.AgreedToPersonalDataProcessing)
                </td>
                <td>
                    @Html.EditorFor(m => m.AgreedToPersonalDataProcessing)
                    @Html.ValidationMessageFor(m => m.AgreedToPersonalDataProcessing)
                </td>
            </tr>
        </table>
        </fieldset>

        <button type="submit">Записать черновик</button>
        <button type="submit">Сохранить</button>

    </div>
}

<script type="text/javascript">
    $(document).ready(function () {
        setActiveMenuItem("empGeneralInfo");

        $("#DateOfBirth").datepicker();
        
        $("#add-name-change-button").click(function () {
            $("#cmd").val("add-name-change");
        });

        // Переключение флажка отсутствия отчества
        $("#IsPatronymicAbsent").click(function () {
            if ($(this).attr("checked") === true) {
                $("#Patronymic").attr("disabled", "disabled");
            }
            else {
                $("#Patronymic").removeAttr("disabled");
            }
        });
    });
</script>