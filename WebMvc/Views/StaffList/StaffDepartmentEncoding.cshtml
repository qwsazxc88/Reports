@model Reports.Presenters.UI.ViewModel.StaffList.StaffDepartmentEncodingModel
@{
    Layout = "~/Views/Shared/_LayoutStaffList.cshtml";
    ViewBag.Title = "Справочник кодирования";
}

@using (Html.BeginForm("StaffDepartmentEncoding", "StaffList", FormMethod.Post, new { enctype = "multipart/form-data", id = "StaffDepartmentEncodingForm" }))
{
    @Html.HiddenFor(m => m.TabIndex)
    <div id="tabs">
        <ul>
            <li><a href="/StaffList/StaffDepartmentBranch">Филиалы</a></li>
            <li><a href="#">Дирекции</a></li>
            <li><a href="#">Управления</a></li>
            <li><a href="#">Бизнес-группы</a></li>
            <li><a href="#">РП-привязки</a></li>
        </ul>

        <div id="tab1"></div>
        <div id="tab2"></div>
        <div id="tab3"></div>
        <div id="tab4"></div>
        <div id="tab5"></div>
    </div>
    
    <div id="DivIndicator" style="display:none;">
        <table>
            <tr>
                <td><span id="LoadingIndicator2"></span></td>
                <td><label>Идет загрузка данных...</label></td>
            </tr>
        </table>
    </div>
    
}


<script type="text/javascript">
    $(document).ready(function () {
        setActiveMenuItem("moDepEncoding");

        $.ajaxSetup({ cache: false });
        var ti = $("#TabIndex").val();
        //вкладки обрабатываются не так как в приеме, потому что разные версии JQuery (в приеме старая версия)
        $("#tabs").tabs({
            beforeLoad: function (event, ui) {
                ui.jqXHR.fail(function () {
                    ui.panel.html("Возникла ошибка при загрузке страницы!");
                });
            },
            cache: false,
            ajaxOption: { cache: false },
            spinner: "Загрузка...",
            active: 1//$("#TabIndex").val()
        });

        $("#tabs").tabs({ active: $("#TabIndex").val()});


        //        $('#tabs').tabs({
        //            cache: false,
        //            ajaxOption: { cache: false },
        //            spinner: "Загрузка...",
        //            active: $("#TabIndex").val(),
        //            activate: function (e, ui) {
        //                console.log(e);
        //                console.log(ui);
        //                console.log(ui.newPanel.selector);
        //                //первая вкладка
        //                if (ui.newPanel.selector == "tab1") {
        //                    $("#tab1").text('Подождите, идет загрузка данных ...');
        //                    AjaxFormRequest("tab1", "GeneralInfoReadOnly", "/Employment/GeneralInfoReadOnly?Id=@Model.CandidateID", "GET");
        //                    $("#tab1").ajaxStop(function () {
        //                    });
        //                }

        //                //вторая вкладка
        //                if (ui.newPanel.selector == "tab2") {
        //                    $("#tab2").text('Подождите, идет загрузка данных ...');
        //                    AjaxFormRequest("tab2", "PassportReadOnly", "/Employment/PassportReadOnly?Id=@Model.CandidateID", "GET");
        //                    $("#tab2").ajaxStop(function () {
        //                    });
        //                }

        //                //третья вкладка
        //                if (ui.newPanel.selector == "tab3") {
        //                    $("#tab3").text('Подождите, идет загрузка данных ...');
        //                    AjaxFormRequest("tab3", "EducationReadOnly", "/Employment/EducationReadOnly?Id=@Model.CandidateID", "GET");
        //                    $("#tab3").ajaxStop(function () {
        //                    });
        //                }

        //                //четвертая
        //                if (ui.newPanel.selector == "tab4") {
        //                    $("#tab4").text('Подождите, идет загрузка данных ...');
        //                    AjaxFormRequest("tab4", "FamilyReadOnly", "/Employment/FamilyReadOnly?Id=@Model.CandidateID", "GET");
        //                    $("#tab4").ajaxStop(function () {
        //                    });
        //                }

        //                //пятая
        //                if (ui.newPanel.selector == "tab5") {
        //                    $("#tab5").text('Подождите, идет загрузка данных ...');
        //                    AjaxFormRequest("tab5", "MilitaryServiceReadOnly", "/Employment/MilitaryServiceReadOnly?Id=@Model.CandidateID", "GET");
        //                    $("#tab5").ajaxStop(function () {
        //                    });
        //                }
        //            }
        //        });

        $(document).tooltip({ track: false });

        //ShowFlash(true);
        //ShowFlash(false);
        $(":button").button();
    });




    function ShowFlash(IsShow)  //показываем индикатор загрузки
    {
        if (!IsShow) {
            $("#LoadingIndicator2").removeClass("loading2");
            $("#DivIndicator").dialog("close");
            $("#DivIndicator").hide();
        }
        else {
            $("#LoadingIndicator2").addClass("loading2");
            $("#DivIndicator").show();
            $("#DivIndicator").dialog(
            { // initialize dialog box
                autoOpen: true,
                modal: true,
                // fix IE6  
                bgiframe: true,
                draggable: false,
                resizable: false,
                width: 300,
                height: 60,
                closeOnEscape: false,
                close: function (event, ui) {
                    //$(this).dialog("destroy").remove();
                }
            });
            $(".ui-dialog-titlebar").hide();
            $(".ui-dialog-titlebar-close").hide();
        }
    }

    //функция отправки и получения ajax-запроса
    function AjaxFormRequest(result_id, form_id, url, TypePost) {
        jQuery.ajax({
            url: url, //Адрес подгружаемой страницы
            type: TypePost, //Тип запроса
            dataType: "html", //Тип данных
            data: jQuery("#" + form_id).serialize(),
            success: function (response) { //Если все нормально
                document.getElementById(result_id).innerHTML = response;
            },
            error: function (response) { //Если ошибка
                document.getElementById(result_id).innerHTML = "Ошибка при отправке формы";
            }
        });
    }
</script>
